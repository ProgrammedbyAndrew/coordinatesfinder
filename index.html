<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Ensures mobile devices render content at device width -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Coordinate Recorder (No Time)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 16px;
      padding: 0;
      font-size: 1.2rem;  /* Larger base font for mobile */
      background-color: #f9f9f9;
    }

    h1 {
      text-align: center;
      font-size: 1.5rem;
      margin-bottom: 16px;
    }

    .coords {
      margin-bottom: 16px;
      text-align: center;
    }
    .coords div {
      margin: 8px 0;
      font-size: 1.4rem;
    }

    .label {
      font-weight: bold;
      margin-right: 6px;
    }

    .buttons-container {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 12px;
    }

    button {
      padding: 16px;
      font-size: 1.1rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      max-width: 300px;
      margin: 0 auto; /* Center the button block */
      color: #fff;
    }

    /* Different button colors for clarity */
    #refreshBtn {
      background-color: #28a745;
    }
    #recordBtn {
      background-color: #007bff;
    }
    #downloadBtn {
      background-color: #17a2b8;
    }
    #loadBtn {
      background-color: #6c757d;
    }

    .row {
      text-align: center;
      margin-bottom: 12px;
    }
    .row input {
      padding: 12px;
      font-size: 1rem;
      width: 80%;
      max-width: 300px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #message {
      font-size: 1rem;
      margin: 12px auto 12px auto;
      text-align: center;
      max-width: 400px;
    }
    .status {
      color: green;
    }
    .error {
      color: red;
    }

    #dataTextArea {
      display: block;
      width: 90%;
      max-width: 400px;
      margin: 0 auto 16px auto;
      height: 200px;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 8px;
      font-size: 1rem;
      line-height: 1.4;
      resize: vertical;
    }
  </style>
</head>
<body>
  <h1>Coordinate Recorder (No Time)</h1>

  <!-- Current position display -->
  <div class="coords">
    <div>
      <span class="label">Latitude:</span>
      <span id="lat">--</span>
    </div>
    <div>
      <span class="label">Longitude:</span>
      <span id="lon">--</span>
    </div>
  </div>

  <!-- Buttons for refreshing coords, recording, loading, etc. -->
  <div class="buttons-container">
    <button id="refreshBtn">Refresh Coordinates</button>
    <button id="recordBtn">Record</button>
    <button id="downloadBtn">Download Data</button>
    <button id="loadBtn">Load Coordinates</button>
  </div>

  <!-- Input for location name -->
  <div class="row">
    <input type="text" id="locName" placeholder="Location Name (e.g. Truck #1)" />
  </div>

  <div id="message"></div>

  <!-- Text area displaying recorded points -->
  <textarea id="dataTextArea" readonly></textarea>

  <script>
    let currentLat = null;
    let currentLon = null;

    // In-memory store of recorded points
    // Each item is { name: string, latitude: number, longitude: number }
    let recordedPoints = [];

    const latEl         = document.getElementById('lat');
    const lonEl         = document.getElementById('lon');
    const locNameInput  = document.getElementById('locName');
    const messageEl     = document.getElementById('message');
    const dataTextArea  = document.getElementById('dataTextArea');

    const refreshBtn    = document.getElementById('refreshBtn');
    const recordBtn     = document.getElementById('recordBtn');
    const downloadBtn   = document.getElementById('downloadBtn');
    const loadBtn       = document.getElementById('loadBtn');

    // --- 1) Refresh Coordinates on demand ---
    refreshBtn.addEventListener('click', () => {
      messageEl.innerHTML = '';
      if (!('geolocation' in navigator)) {
        messageEl.innerHTML = '<p class="error">Geolocation not supported.</p>';
        return;
      }
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          currentLat = pos.coords.latitude;
          currentLon = pos.coords.longitude;
          latEl.textContent = currentLat.toFixed(6);
          lonEl.textContent = currentLon.toFixed(6);
          messageEl.innerHTML = '<p class="status">Coordinates refreshed.</p>';
        },
        (err) => {
          messageEl.innerHTML = `<p class="error">Error getting location: ${err.message}</p>`;
        },
        { enableHighAccuracy: true }
      );
    });

    // --- 2) Record the displayed coords + name (no timestamp) ---
    recordBtn.addEventListener('click', () => {
      messageEl.innerHTML = '';
      if (currentLat === null || currentLon === null) {
        messageEl.innerHTML = '<p class="error">Please refresh coordinates before recording.</p>';
        return;
      }
      const nameVal = locNameInput.value.trim();
      if (!nameVal) {
        messageEl.innerHTML = '<p class="error">Enter a location name.</p>';
        return;
      }

      // Build an object for the coordinate
      const entry = {
        name: nameVal,
        latitude: currentLat,
        longitude: currentLon
      };
      recordedPoints.push(entry);

      // Save to localStorage (stringify the entire array)
      localStorage.setItem('savedCoordinates', JSON.stringify(recordedPoints));

      // Confirmation
      messageEl.innerHTML = `<p class="status">Recorded "${nameVal}" at ${currentLat.toFixed(5)}, ${currentLon.toFixed(5)}</p>`;
      updateDataTextArea();
    });

    // --- 3) Download recordedPoints as .txt (no timestamp) ---
    downloadBtn.addEventListener('click', () => {
      messageEl.innerHTML = '';
      if (recordedPoints.length === 0) {
        messageEl.innerHTML = '<p class="error">No data to download.</p>';
        return;
      }
      // Convert array to CSV-like text
      // We'll do "Location Name,Latitude,Longitude"
      let fileContent = "Location Name,Latitude,Longitude\n";
      recordedPoints.forEach(pt => {
        fileContent += `"${pt.name}",${pt.latitude},${pt.longitude}\n`;
      });

      const blob = new Blob([fileContent], { type: 'text/plain' });
      const blobUrl = URL.createObjectURL(blob);

      const tempLink = document.createElement('a');
      tempLink.href = blobUrl;
      tempLink.download = 'coordinates.txt';
      document.body.appendChild(tempLink);
      tempLink.click();
      document.body.removeChild(tempLink);

      setTimeout(() => URL.revokeObjectURL(blobUrl), 1000);
    });

    // --- 4) Load from localStorage (if previously saved) ---
    loadBtn.addEventListener('click', () => {
      messageEl.innerHTML = '';
      const saved = localStorage.getItem('savedCoordinates');
      if (!saved) {
        messageEl.innerHTML = '<p class="error">No saved coordinates found.</p>';
        return;
      }
      try {
        recordedPoints = JSON.parse(saved) || [];
        messageEl.innerHTML = `<p class="status">Loaded ${recordedPoints.length} record(s).</p>`;
        updateDataTextArea();
      } catch (err) {
        messageEl.innerHTML = '<p class="error">Error parsing saved data.</p>';
      }
    });

    // Show the recordedPoints in the text area
    function updateDataTextArea() {
      let text = '';
      recordedPoints.forEach((pt, i) => {
        text += `[${i + 1}] "${pt.name}" => (${pt.latitude.toFixed(5)}, ${pt.longitude.toFixed(5)})\n`;
      });
      dataTextArea.value = text;
    }
  </script>
</body>
</html>
